<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç«™ç‚¹æŠ«è¨ Â· ä¸€é”®ç”Ÿæˆå°çº¢ä¹¦</title>
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Noto+Sans+SC:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, #1a1a1a 0%, #2d1f1f 100%);
            color: white;
            min-height: 100vh;
            padding: 1rem;
        }

        .container {
            max-width: 500px;
            margin: 0 auto;
        }

        .logo {
            font-family: 'Bebas Neue', cursive;
            font-size: 2.5rem;
            color: #ff6b35;
            text-align: center;
            margin: 2rem 0 1rem;
            text-shadow: 3px 3px 0px rgba(0,0,0,0.3);
            letter-spacing: 2px;
        }

        .subtitle {
            text-align: center;
            font-size: 1.1rem;
            margin-bottom: 2rem;
            opacity: 0.9;
        }

        .loading-screen {
            text-align: center;
            padding: 3rem 1rem;
        }

        .pizza-icon {
            font-size: 5rem;
            animation: rotate 2s linear infinite;
            margin-bottom: 2rem;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.3rem;
            margin-bottom: 1rem;
            color: #ff6b35;
            font-weight: bold;
        }

        .loading-steps {
            opacity: 0.7;
            line-height: 2.2;
            font-size: 1.05rem;
        }

        .loading-steps p {
            transition: all 0.3s ease;
        }

        .result-screen {
            display: none;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 107, 53, 0.3);
            border-radius: 20px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .section-title {
            color: #ffc107;
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .content {
            background: rgba(0, 0, 0, 0.3);
            padding: 1.5rem;
            border-radius: 12px;
            line-height: 1.8;
            white-space: pre-wrap;
            margin-bottom: 1rem;
            max-height: 400px;
            overflow-y: auto;
            font-size: 0.95rem;
        }

        .content::-webkit-scrollbar {
            width: 6px;
        }

        .content::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
        }

        .content::-webkit-scrollbar-thumb {
            background: rgba(255, 107, 53, 0.5);
            border-radius: 3px;
        }

        .image-container {
            width: 100%;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 1rem;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
        }

        .image-container img {
            width: 100%;
            height: auto;
            display: block;
        }

        .action-btns {
            display: flex;
            gap: 0.8rem;
            margin-top: 1rem;
        }

        .btn {
            flex: 1;
            padding: 1.1rem;
            border: none;
            border-radius: 12px;
            font-size: 1.05rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-copy {
            background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%);
            color: #1a1a1a;
        }

        .btn-share {
            background: linear-gradient(135deg, #ee4266 0%, #d32f2f 100%);
            color: white;
        }

        .btn:active {
            transform: scale(0.95);
        }

        .btn-download {
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            color: white;
            width: 100%;
            margin-top: 0.8rem;
        }

        .tip {
            background: rgba(255, 193, 7, 0.1);
            border: 2px solid rgba(255, 193, 7, 0.3);
            border-radius: 12px;
            padding: 1rem;
            margin-top: 1rem;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .store-info {
            text-align: center;
            background: rgba(255, 107, 53, 0.2);
            padding: 0.8rem;
            border-radius: 10px;
            margin-bottom: 2rem;
            font-size: 0.95rem;
            border: 2px solid rgba(255, 107, 53, 0.3);
        }

        .success-icon {
            font-size: 3rem;
            text-align: center;
            margin-bottom: 1rem;
            animation: bounce 1s ease;
        }

        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-20px); }
            60% { transform: translateY(-10px); }
        }

        .error-screen {
            display: none;
            text-align: center;
            padding: 2rem 1rem;
        }

        .error-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
        }

        .error-text {
            font-size: 1.1rem;
            color: #ee4266;
            margin-bottom: 1.5rem;
            line-height: 1.6;
        }

        .error-details {
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 10px;
            margin-bottom: 1.5rem;
            font-size: 0.9rem;
            text-align: left;
            line-height: 1.8;
        }

        .retry-btn {
            background: linear-gradient(135deg, #ff6b35 0%, #d32f2f 100%);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            margin: 0.5rem;
        }

        @media (max-width: 480px) {
            .logo { font-size: 2rem; }
            .action-btns { flex-direction: column; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="logo">ğŸ• TUBE STATION</div>
        <div class="subtitle">ç«™ç‚¹æŠ«è¨ Â· å°çº¢ä¹¦ä¸€é”®ç”Ÿæˆ</div>

        <!-- åŠ è½½ç•Œé¢ -->
        <div class="loading-screen" id="loadingScreen">
            <div class="pizza-icon">ğŸ•</div>
            <div class="loading-text">æ­£åœ¨ä¸ºæ‚¨ç”Ÿæˆä¸“å±å†…å®¹...</div>
            <div class="loading-steps">
                <p id="step1">â³ è¯†åˆ«é—¨åº—ä½ç½®...</p>
                <p id="step2">â³ AIåˆ›ä½œæ–‡æ¡ˆä¸­...</p>
                <p id="step3">â³ ç”Ÿæˆç²¾ç¾é…å›¾...</p>
            </div>
        </div>

        <!-- ç»“æœç•Œé¢ -->
        <div class="result-screen" id="resultScreen">
            <div class="success-icon">âœ¨ğŸ‰âœ¨</div>
            <div class="store-info" id="storeInfo"></div>
            
            <!-- é…å›¾ -->
            <div class="card">
                <div class="section-title">ğŸ“¸ å°çº¢ä¹¦é…å›¾</div>
                <div class="image-container" id="imageContainer"></div>
                <button class="btn btn-download" onclick="downloadImage()">
                    ğŸ’¾ é•¿æŒ‰ä¿å­˜å›¾ç‰‡
                </button>
            </div>

            <!-- æ–‡æ¡ˆ -->
            <div class="card">
                <div class="section-title">ğŸ“ å°çº¢ä¹¦æ–‡æ¡ˆ</div>
                <div class="content" id="textContent"></div>
                <div class="action-btns">
                    <button class="btn btn-copy" onclick="copyText()">
                        ğŸ“‹ å¤åˆ¶æ–‡æ¡ˆ
                    </button>
                    <button class="btn btn-share" onclick="openXHS()">
                        ğŸ“± æ‰“å¼€å°çº¢ä¹¦
                    </button>
                </div>
            </div>

            <div class="tip">
                ğŸ’¡ <strong>å‘å¸ƒæ­¥éª¤ï¼š</strong><br>
                1ï¸âƒ£ ç‚¹å‡»"å¤åˆ¶æ–‡æ¡ˆ"ï¼ˆè‡ªåŠ¨å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼‰<br>
                2ï¸âƒ£ é•¿æŒ‰ä¸Šæ–¹å›¾ç‰‡ä¿å­˜åˆ°ç›¸å†Œ<br>
                3ï¸âƒ£ ç‚¹å‡»"æ‰“å¼€å°çº¢ä¹¦"è·³è½¬APP<br>
                4ï¸âƒ£ æ–°å»ºç¬”è®° â†’ ä¸Šä¼ å›¾ç‰‡ â†’ ç²˜è´´æ–‡æ¡ˆ<br>
                5ï¸âƒ£ å‘å¸ƒå¸¦è¯é¢˜ <strong>#ç«™ç‚¹æŠ«è¨</strong> æœ‰æœºä¼šè·å¾—ä¼˜æƒ åˆ¸ ğŸ
            </div>
        </div>

        <!-- é”™è¯¯ç•Œé¢ -->
        <div class="error-screen" id="errorScreen">
            <div class="error-icon">ğŸ˜¢</div>
            <div class="error-text" id="errorText"></div>
            <div class="error-details" id="errorDetails"></div>
            <button class="retry-btn" onclick="location.reload()">
                ğŸ”„ é‡æ–°ç”Ÿæˆ
            </button>
        </div>
    </div>

    <script>
        // DeepSeek APIå¯†é’¥
        const DEEPSEEK_API_KEY = 'sk-b1ec9124ec424324bd90fb8d17bd2e08';

        // ä»URLå‚æ•°è·å–é—¨åº—å’Œèœå“ä¿¡æ¯
        const urlParams = new URLSearchParams(window.location.search);
        const store = urlParams.get('store') || 'ç«™ç‚¹æŠ«è¨';
        const pizza = urlParams.get('pizza') || 'åƒåœ¾æ¡¶';

        // é¡µé¢åŠ è½½åè‡ªåŠ¨ç”Ÿæˆ
        window.onload = function() {
            // æ£€æµ‹æ˜¯å¦æ˜¯HTTPSæˆ–æœ¬åœ°æ–‡ä»¶
            if (window.location.protocol === 'file:') {
                showError(
                    'âŒ æ£€æµ‹åˆ°æœ¬åœ°æ–‡ä»¶æ¨¡å¼',
                    'æœ¬å·¥å…·éœ€è¦éƒ¨ç½²åˆ°WebæœåŠ¡å™¨æ‰èƒ½æ­£å¸¸ä½¿ç”¨ã€‚\n\nğŸ“ è§£å†³æ–¹æ¡ˆï¼š\n\n1. ä½¿ç”¨Pythonå¿«é€Ÿå¯åŠ¨ï¼š\n   python3 -m http.server 8080\n   ç„¶åè®¿é—® http://localhost:8080\n\n2. æˆ–ä¸Šä¼ åˆ°ä»»ä½•WebæœåŠ¡å™¨\n\n3. ä¹Ÿå¯ä»¥ä½¿ç”¨å…è´¹æ‰˜ç®¡ï¼š\n   â€¢ Vercel (vercel.com)\n   â€¢ Netlify (netlify.com)\n   â€¢ GitHub Pages'
                );
                return;
            }
            
            autoGenerate();
        };

        async function autoGenerate() {
            try {
                // æ­¥éª¤1ï¼šè¯†åˆ«é—¨åº—
                updateStep('step1', 'âœ“ è¯†åˆ«é—¨åº—ä½ç½®');
                await sleep(500);

                // æ­¥éª¤2ï¼šç”Ÿæˆæ–‡æ¡ˆ
                updateStep('step2', 'â³ AIåˆ›ä½œæ–‡æ¡ˆä¸­...');
                const text = await generateText();
                updateStep('step2', 'âœ“ AIåˆ›ä½œæ–‡æ¡ˆå®Œæˆ');
                await sleep(400);

                // æ­¥éª¤3ï¼šç”Ÿæˆå›¾ç‰‡
                updateStep('step3', 'â³ ç”Ÿæˆç²¾ç¾é…å›¾...');
                const imageUrl = await generateImage();
                updateStep('step3', 'âœ“ ç”Ÿæˆé…å›¾å®Œæˆ');
                await sleep(400);

                // æ˜¾ç¤ºç»“æœ
                showResult(text, imageUrl);
            } catch (error) {
                console.error('ç”Ÿæˆå¤±è´¥:', error);
                
                let errorTitle = 'ç”Ÿæˆå¤±è´¥';
                let errorDetail = '';
                
                if (error.message.includes('Failed to fetch') || error.message.includes('fetch')) {
                    errorTitle = 'âŒ ç½‘ç»œè¯·æ±‚å¤±è´¥';
                    errorDetail = 'å¯èƒ½çš„åŸå› ï¼š\n\n1. éœ€è¦HTTPSæˆ–æœ¬åœ°æœåŠ¡å™¨ç¯å¢ƒ\n2. ç½‘ç»œè¿æ¥é—®é¢˜\n3. APIæœåŠ¡æš‚æ—¶ä¸å¯ç”¨\n\nğŸ’¡ å»ºè®®ï¼š\nâ€¢ ç¡®ä¿å·²éƒ¨ç½²åˆ°WebæœåŠ¡å™¨\nâ€¢ æ£€æŸ¥ç½‘ç»œè¿æ¥\nâ€¢ ç¨åé‡è¯•';
                } else if (error.message.includes('API')) {
                    errorTitle = 'âŒ APIè°ƒç”¨å¤±è´¥';
                    errorDetail = error.message + '\n\nè¯·è”ç³»æŠ€æœ¯äººå‘˜æ£€æŸ¥APIé…ç½®';
                } else {
                    errorTitle = 'âŒ ' + error.message;
                    errorDetail = 'è¯·ç¨åé‡è¯•æˆ–è”ç³»æŠ€æœ¯æ”¯æŒ';
                }
                
                showError(errorTitle, errorDetail);
            }
        }

        function updateStep(id, text) {
            const element = document.getElementById(id);
            element.innerHTML = text;
            if (text.startsWith('âœ“')) {
                element.style.color = '#4caf50';
                element.style.fontWeight = 'bold';
            }
        }

        async function generateText() {
            const pizzaDescriptions = {
                'åƒåœ¾æ¡¶': 'ä»–ä»¬å®¶çš„æ‹›ç‰Œ"åƒåœ¾æ¡¶æŠ«è¨"ï¼Œé™¤äº†ä¸‰æ–‡é±¼å’ŒBBQé¸¡è‚‰ï¼Œå…¶ä»–æ‰€æœ‰é…æ–™éƒ½åœ¨ä¸Šé¢ï¼æ„å¤§åˆ©é¦™è‚ ã€è¨æ‹‰ç±³ã€ç‰›è‚‰ã€çŒªè‚‰ã€åŸ¹æ ¹ã€ç«è…¿ã€è˜‘è‡ã€æ©„æ¦„...æ»¡æ»¡å½“å½“ï¼',
                'åŠ å·å°ç‰›è‚‰': 'æ»¡æ»¡çš„ç‰›è‚‰é“ºåœ¨ä¸Šé¢ï¼Œé»‘èƒ¡æ¤’é¦™æ°”æ‰‘é¼»è€Œæ¥ï¼Œç‰›è‚‰å«©å¾—ä¸è¡Œï¼Œæ­é…æµ“éƒçš„èŠå£«ï¼Œæ¯ä¸€å£éƒ½æ˜¯äº«å—ï¼',
                'ç»è‚‰æœº': 'è‚‰é£Ÿçˆ±å¥½è€…çš„å¤©å ‚ï¼å„ç§è‚‰ç±»å †å ï¼Œæ¯ä¸€å£éƒ½æ˜¯è‚‰é¦™å››æº¢ï¼Œé…ä¸Šæµ“éƒçš„èŠå£«ï¼Œæ ¹æœ¬åœä¸ä¸‹æ¥ï¼',
                'å¤å¨å¤·BBQ': 'ç”œç”œçš„è èé…ä¸ŠBBQé…±ï¼Œé…¸ç”œå£æ„Ÿç‰¹åˆ«å¼€èƒƒï¼ŒBBQé¸¡è‚‰ä¹Ÿè¶…å…¥å‘³ï¼Œè¿™ä¸ªç»„åˆçœŸçš„å¾ˆç‰¹åˆ«ï¼',
                'æ´¾å¯¹æ€ªå…½': '32å¯¸è¶…å·¨å‹æŠ«è¨ï¼ç«™ç‚¹ç‰¹è‰²ã€åŠ å·å°ç‰›è‚‰ã€æ„å¤§åˆ©é¦™è‚ ã€BBQé¸¡è‚‰å››åˆä¸€ï¼Œ10-15äººä»½çš„è¶…çº§æ€ªå…½ï¼'
            };

            const pizzaDesc = pizzaDescriptions[pizza] || 'æ–™è¶…çº§è¶³ï¼ŒèŠå£«æ‹‰ä¸èƒ½æ‹‰å‡ºä¸€ç±³é•¿ï¼Œæ¯ä¸€å£éƒ½æœ‰æ»¡æ»¡çš„æƒŠå–œï¼';

            const prompt = `è¯·ä»¥å°çº¢ä¹¦çˆ†æ¬¾æ–‡æ¡ˆé£æ ¼ï¼Œä¸ºç«™ç‚¹æŠ«è¨å†™ä¸€ç¯‡æ¢åº—æ‰“å¡æ–‡æ¡ˆã€‚

ã€å“ç‰Œä¿¡æ¯ã€‘
- å“ç‰Œï¼šç«™ç‚¹æŠ«è¨ (Tube Station Pizza)
- åˆ›ç«‹ï¼š2000å¹´ï¼ŒåŒ—äº¬è€ç‰Œç¾å¼æŠ«è¨
- ç‰¹è‰²ï¼šè¶…å¤§sizeæŠ«è¨ï¼ˆæœ€å¤§32å¯¸ï¼‰ï¼Œä»¥"è¶…çº§å¤§çš„æŠ«è¨åœ¨åŒ—äº¬"é—»å
- ç¯å¢ƒï¼šç¾å¼å·¥ä¸šé£è£…ä¿®ï¼Œæœ‹å…‹é£æ ¼ï¼Œé€‚åˆæ‹ç…§
- ä»·æ ¼ï¼šäººå‡80-130å…ƒï¼Œæ€§ä»·æ¯”è¶…é«˜
- é€‚åˆï¼šæœ‹å‹èšä¼šã€ç”Ÿæ—¥æ´¾å¯¹ã€æƒ…ä¾£çº¦ä¼š

ã€æœ¬æ¬¡ä½“éªŒã€‘
- é—¨åº—ï¼š${store}
- ç‚¹é¤ï¼š${pizza}æŠ«è¨
- äº§å“ç‰¹ç‚¹ï¼š${pizzaDesc}

ã€æ–‡æ¡ˆè¦æ±‚ã€‘
1. æ ‡é¢˜è¦æŠ“çœ¼çƒï¼Œç”¨emojiï¼Œè¦æœ‰å†²å‡»åŠ›ï¼ˆä¾‹å¦‚ï¼šğŸš¨ã€ğŸ˜±ã€ğŸ”¥ï¼‰
2. å¼€å¤´è¦æœ‰å¼ºçƒˆçš„ä»£å…¥æ„Ÿï¼Œåƒå’Œé—ºèœœåˆ†äº«æƒŠå–œ
3. é‡ç‚¹çªå‡ºï¼š
   - æŠ«è¨çš„è¶…å¤§sizeï¼ˆè§†è§‰éœ‡æ’¼ï¼‰
   - æ–™ç‰¹åˆ«è¶³ï¼ˆæ€§ä»·æ¯”ï¼‰
   - è–„é¥¼åº•è¶…é…¥è„†
   - èŠå£«æ‹‰ä¸çš„ç”»é¢æ„Ÿ
   - ç¾å¼å·¥ä¸šé£ç¯å¢ƒå¾ˆé…·
4. è¯­è¨€é£æ ¼ï¼š
   - å¹´è½»åŒ–ã€æ¿€åŠ¨ã€å……æ»¡æƒŠå¹
   - å¤šç”¨"å¤ªXXXäº†ï¼"ã€"çœŸçš„ç»äº†"ã€"æˆ‘æ…Œäº†"ç­‰è¡¨è¾¾
   - é€‚å½“ä½¿ç”¨å°çº¢ä¹¦æµè¡Œè¯­
5. å¤šç”¨emojiï¼ˆæ¯æ®µè‡³å°‘2-3ä¸ªï¼‰
6. åˆ†æ®µæ¸…æ™°ï¼Œæ¯æ®µ2-4è¡Œ
7. ç»“å°¾è¦æœ‰äº’åŠ¨æ„Ÿï¼Œå¼•å¯¼æ‰“å¡
8. å¿…é¡»åŒ…å«è¿™äº›è¯é¢˜æ ‡ç­¾ï¼š#ç«™ç‚¹æŠ«è¨ #åŒ—äº¬ç¾é£Ÿ #æŠ«è¨æ¨è #æ¢åº—æ‰“å¡ #è¶…å¤§æŠ«è¨ #ç¾é£Ÿåˆ†äº«
9. å­—æ•°ï¼š600-800å­—

è¯·ç›´æ¥è¾“å‡ºæ–‡æ¡ˆï¼Œä¸è¦ä»»ä½•è¯´æ˜æˆ–å‰ç¼€ã€‚`;

            try {
                const response = await fetch('https://api.deepseek.com/v1/chat/completions', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${DEEPSEEK_API_KEY}`
                    },
                    body: JSON.stringify({
                        model: 'deepseek-chat',
                        messages: [
                            {
                                role: 'system',
                                content: 'ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å°çº¢ä¹¦ç¾é£Ÿåšä¸»ï¼Œæ“…é•¿å†™çˆ†æ¬¾æ¢åº—æ–‡æ¡ˆã€‚ä½ çš„æ–‡æ¡ˆé£æ ¼çœŸå®ã€çƒ­æƒ…ã€æœ‰æ„ŸæŸ“åŠ›ï¼Œå–„äºç”¨ç”ŸåŠ¨çš„è¯­è¨€æè¿°ç¾é£Ÿï¼Œè®©è¯»è€…äº§ç”Ÿå¼ºçƒˆçš„ä»£å…¥æ„Ÿå’Œé£Ÿæ¬²ã€‚'
                            },
                            {
                                role: 'user',
                                content: prompt
                            }
                        ],
                        temperature: 0.9,
                        max_tokens: 2000
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(`APIè¯·æ±‚å¤±è´¥: ${response.status} - ${errorData.error?.message || 'æœªçŸ¥é”™è¯¯'}`);
                }

                const data = await response.json();
                return data.choices[0].message.content;
            } catch (error) {
                if (error.message.includes('fetch')) {
                    throw new Error('ç½‘ç»œè¯·æ±‚å¤±è´¥ - è¯·ç¡®ä¿å·²éƒ¨ç½²åˆ°WebæœåŠ¡å™¨');
                }
                throw error;
            }
        }

        async function generateImage() {
            const imagePrompts = {
                'åƒåœ¾æ¡¶': 'giant american pizza loaded with multiple toppings, salami, beef, bacon, mushrooms, olives, melted mozzarella cheese, on wooden table, professional food photography, warm restaurant lighting, appetizing, ultra detailed, high quality',
                'åŠ å·å°ç‰›è‚‰': 'delicious american pizza with abundant beef topping, black pepper seasoning, melted cheese, close-up shot, professional food photography, warm lighting, appetizing, high quality',
                'ç»è‚‰æœº': 'meat lovers pizza with multiple meat toppings, beef, sausage, bacon, ham, melted cheese, professional food photography, appetizing, ultra detailed',
                'å¤å¨å¤·BBQ': 'hawaiian BBQ pizza with pineapple, BBQ chicken, melted cheese, colorful toppings, professional food photography, bright lighting, appetizing',
                'æ´¾å¯¹æ€ªå…½': 'extra large 32 inch american pizza, multiple sections with different toppings, party size pizza, overhead view, professional food photography, restaurant setting'
            };

            const basePrompt = imagePrompts[pizza] || 'delicious large american style pizza with melted cheese, various toppings, professional food photography, warm lighting, appetizing, high quality';
            
            const fullPrompt = `${basePrompt}, Tube Station Pizza restaurant, instagram food photography style, aesthetic, trending`;
            
            const imageUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(fullPrompt)}?width=1024&height=1024&nologo=true&enhance=true&seed=${Date.now()}`;
            
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => resolve(imageUrl);
                img.onerror = () => reject(new Error('å›¾ç‰‡ç”Ÿæˆå¤±è´¥'));
                img.src = imageUrl;
                
                setTimeout(() => reject(new Error('å›¾ç‰‡åŠ è½½è¶…æ—¶')), 15000);
            });
        }

        function showResult(text, imageUrl) {
            document.getElementById('loadingScreen').style.display = 'none';
            const resultScreen = document.getElementById('resultScreen');
            resultScreen.style.display = 'block';
            
            document.getElementById('storeInfo').innerHTML = `ğŸ“ ${store} | ğŸ• ${pizza}æŠ«è¨`;
            
            document.getElementById('imageContainer').innerHTML = `
                <img src="${imageUrl}" alt="ç«™ç‚¹æŠ«è¨ - ${pizza}" id="generatedImage">
            `;
            
            document.getElementById('textContent').textContent = text;
            
            window.generatedText = text;
            window.generatedImage = imageUrl;
        }

        function showError(title, details) {
            document.getElementById('loadingScreen').style.display = 'none';
            const errorScreen = document.getElementById('errorScreen');
            errorScreen.style.display = 'block';
            
            document.getElementById('errorText').textContent = title;
            document.getElementById('errorDetails').textContent = details;
        }

        function copyText() {
            if (!window.generatedText) {
                alert('æ–‡æ¡ˆè¿˜æœªç”Ÿæˆ');
                return;
            }

            navigator.clipboard.writeText(window.generatedText).then(() => {
                const btn = event.target.closest('.btn-copy');
                const originalHTML = btn.innerHTML;
                btn.innerHTML = 'âœ… å·²å¤åˆ¶';
                btn.style.background = 'linear-gradient(135deg, #4caf50 0%, #45a049 100%)';
                
                setTimeout(() => {
                    btn.innerHTML = originalHTML;
                    btn.style.background = 'linear-gradient(135deg, #ffc107 0%, #ff9800 100%)';
                }, 2000);

                showToast('âœ… æ–‡æ¡ˆå·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
            }).catch(() => {
                alert('âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶æ–‡æ¡ˆ');
            });
        }

        function downloadImage() {
            showToast('ğŸ’¡ è¯·é•¿æŒ‰å›¾ç‰‡ä¿å­˜åˆ°ç›¸å†Œ');
        }

        function openXHS() {
            if (!window.generatedText) {
                alert('è¯·å…ˆå¤åˆ¶æ–‡æ¡ˆ');
                return;
            }

            const xhsUrl = 'xhslink://';
            const xhsWebUrl = 'https://www.xiaohongshu.com';
            
            window.location.href = xhsUrl;
            
            setTimeout(() => {
                if (confirm('ğŸ“± æ­£åœ¨æ‰“å¼€å°çº¢ä¹¦APP...\n\nå¦‚æœæœªè‡ªåŠ¨è·³è½¬ï¼Œç‚¹å‡»"ç¡®å®š"è®¿é—®ç½‘é¡µç‰ˆ')) {
                    window.open(xhsWebUrl, '_blank');
                }
                
                setTimeout(() => {
                    alert('ğŸ’¡ å‘å¸ƒæŒ‡å—ï¼š\n\n1. åœ¨å°çº¢ä¹¦ç‚¹å‡»åº•éƒ¨"+"å·\n2. é€‰æ‹©"ç¬”è®°"\n3. ä¸Šä¼ åˆšæ‰ä¿å­˜çš„å›¾ç‰‡\n4. ç²˜è´´å·²å¤åˆ¶çš„æ–‡æ¡ˆ\n5. æ·»åŠ è¯é¢˜ #ç«™ç‚¹æŠ«è¨\n6. å‘å¸ƒå³å¯ï¼\n\nğŸ å‘å¸ƒåæˆªå›¾ç»™åº—å‘˜æœ‰æƒŠå–œ~');
                }, 1000);
            }, 800);
        }

        function showToast(message) {
            const toast = document.createElement('div');
            toast.textContent = message;
            toast.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: rgba(0, 0, 0, 0.85);
                color: white;
                padding: 1rem 2rem;
                border-radius: 10px;
                font-size: 1rem;
                z-index: 9999;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            `;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transition = 'opacity 0.3s ease';
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 2000);
        }

        function sleep(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }
    </script>
</body>
</html>
